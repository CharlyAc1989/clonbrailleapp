<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <meta name="description" content="Braillito - Aprende Braille a trav√©s de minijuegos interactivos">
    <title>Braillito - Aprende Braille Jugando</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Braillito">
    <link rel="apple-touch-icon" href="/public/mascot.svg">
</head>

<body>
    <!-- Install Modal (Popup Style) -->
    <div id="install-screen" class="install-modal-overlay hidden" role="dialog" aria-modal="true"
        aria-label="Instalar aplicaci√≥n">
        <!-- Dark backdrop with blur -->
        <div class="install-modal-backdrop"></div>

        <!-- Modal Card -->
        <div class="install-modal-card">
            <!-- Decorative top gradient -->
            <div class="install-modal-gradient"></div>
            <div class="install-modal-glow"></div>

            <!-- Content -->
            <div class="install-modal-content">
                <!-- Mascot -->
                <div class="install-modal-mascot">
                    <div class="install-modal-mascot-circle">
                        <svg class="install-modal-pet-svg" fill="none" viewBox="0 0 200 200"
                            xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <filter height="140%" id="soft-shadow-modal" width="140%" x="-20%" y="-20%">
                                    <feGaussianBlur in="SourceAlpha" stdDeviation="2"></feGaussianBlur>
                                    <feOffset dx="0" dy="3" result="offsetblur"></feOffset>
                                    <feComponentTransfer>
                                        <feFuncA slope="0.15" type="linear"></feFuncA>
                                    </feComponentTransfer>
                                    <feMerge>
                                        <feMergeNode></feMergeNode>
                                        <feMergeNode in="SourceGraphic"></feMergeNode>
                                    </feMerge>
                                </filter>
                            </defs>
                            <g filter="url(#soft-shadow-modal)">
                                <!-- Antenna -->
                                <line stroke="#112117" stroke-linecap="round" stroke-width="4" x1="100" x2="100" y1="50"
                                    y2="25"></line>
                                <circle cx="100" cy="25" fill="#ff9045" r="7"></circle>
                                <!-- Arms -->
                                <path d="M 45 110 Q 30 110 35 80" stroke="white" stroke-linecap="round"
                                    stroke-width="12"></path>
                                <path d="M 155 110 Q 170 110 165 130" stroke="white" stroke-linecap="round"
                                    stroke-width="12"></path>
                                <!-- Body -->
                                <rect fill="white" height="110" rx="45" width="100" x="50" y="50"></rect>
                                <!-- Face -->
                                <g transform="translate(0, 10)">
                                    <ellipse cx="80" cy="80" fill="#112117" rx="10" ry="12"></ellipse>
                                    <ellipse cx="120" cy="80" fill="#112117" rx="10" ry="12"></ellipse>
                                    <circle cx="84" cy="76" fill="white" r="3"></circle>
                                    <circle cx="124" cy="76" fill="white" r="3"></circle>
                                    <circle cx="65" cy="95" fill="#ff9045" opacity="0.4" r="5"></circle>
                                    <circle cx="135" cy="95" fill="#ff9045" opacity="0.4" r="5"></circle>
                                    <path d="M 90 95 Q 100 102 110 95" fill="none" stroke="#112117"
                                        stroke-linecap="round" stroke-width="3"></path>
                                </g>
                                <!-- Belly panel with Braille dots -->
                                <rect x="75" y="120" width="50" height="30" rx="8" fill="#ffedd5"></rect>
                                <circle cx="90" cy="135" r="3" fill="#ff9045"></circle>
                                <circle cx="110" cy="135" r="3" fill="#ff9045"></circle>
                            </g>
                        </svg>
                    </div>
                    <!-- Badge icon -->
                    <div class="install-modal-badge">
                        <span class="material-symbols-outlined">add_to_home_screen</span>
                    </div>
                </div>

                <!-- Title and Description -->
                <h3 class="install-modal-title">¬°Instala Braillito!</h3>
                <p class="install-modal-desc">Instala la Web App en tu iPhone para un acceso r√°pido y una mejor
                    experiencia de aprendizaje.</p>

                <!-- Buttons -->
                <div class="install-modal-buttons">
                    <button id="install-button" class="install-modal-btn-primary">
                        <span>Instalar</span>
                        <span class="material-symbols-outlined">arrow_forward</span>
                    </button>
                    <button id="install-skip-btn" class="install-modal-btn-secondary">
                        Ahora no
                    </button>
                </div>

                <!-- iOS Instructions -->
                <div id="ios-hint" class="install-modal-ios-hint hidden">
                    <span class="install-modal-ios-title">En iOS:</span>
                    <div class="install-modal-ios-step">
                        <span class="install-modal-ios-num">1.</span>
                        <div class="install-modal-ios-icon">
                            <span class="material-symbols-outlined">ios_share</span>
                        </div>
                        <div class="install-modal-ios-text">
                            Toca el √≠cono de <strong>'Compartir'</strong> en la barra de navegaci√≥n.
                        </div>
                    </div>
                    <div class="install-modal-ios-step">
                        <span class="install-modal-ios-num">2.</span>
                        <div class="install-modal-ios-icon">
                            <span class="material-symbols-outlined">add_to_home_screen</span>
                        </div>
                        <div class="install-modal-ios-text">
                            Luego selecciona <strong>'A√±adir a la pantalla de inicio'</strong>.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- App Container -->
    <div id="app" class="app-container" role="application" aria-label="Aplicaci√≥n Braillito">

        <!-- Splash Screen (Loading Only) - Active by default -->
        <section id="splash-screen" class="screen active" role="main" aria-label="Cargando Braillito">
            <div class="welcome-bg-pattern"></div>
            <div
                style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; gap: 1rem;">
                <div class="braillito-logo">
                    <div class="braille-cell-mini">
                        <span class="dot filled"></span>
                        <span class="dot filled"></span>
                        <span class="dot filled"></span>
                        <span class="dot accent"></span>
                        <span class="dot filled"></span>
                        <span class="dot filled"></span>
                    </div>
                    <h2 class="braillito-text">Braillito</h2>
                </div>
                <p id="splash-status" style="color: var(--color-text-muted); font-size: 0.875rem;">Cargando...</p>
            </div>
        </section>

        <!-- Welcome Screen (Interactive) - Hidden by default -->
        <section id="welcome-screen" class="screen welcome-screen" role="main" aria-label="Bienvenida a Braillito">
            <!-- Braille pattern background -->
            <div class="welcome-bg-pattern"></div>
            <div class="welcome-glow"></div>

            <!-- Header with logo -->
            <header class="welcome-header">
                <div class="braillito-logo">
                    <div class="braille-cell-mini">
                        <span class="dot filled"></span>
                        <span class="dot filled"></span>
                        <span class="dot filled"></span>
                        <span class="dot accent"></span>
                        <span class="dot filled"></span>
                        <span class="dot filled"></span>
                    </div>
                    <h2 class="braillito-text">Braillito</h2>
                </div>
            </header>

            <!-- Main content -->
            <main class="welcome-main">
                <!-- Robot mascot -->
                <div class="mascot-container">
                    <div class="mascot-circle">
                        <svg class="robot-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <filter id="pet-shadow" x="-20%" y="-20%" width="140%" height="140%">
                                    <feGaussianBlur in="SourceAlpha" stdDeviation="2"></feGaussianBlur>
                                    <feOffset dx="0" dy="3" result="offsetblur"></feOffset>
                                    <feComponentTransfer>
                                        <feFuncA type="linear" slope="0.15"></feFuncA>
                                    </feComponentTransfer>
                                    <feMerge>
                                        <feMergeNode></feMergeNode>
                                        <feMergeNode in="SourceGraphic"></feMergeNode>
                                    </feMerge>
                                </filter>
                            </defs>
                            <g filter="url(#pet-shadow)">
                                <!-- Antenna -->
                                <line x1="100" y1="50" x2="100" y2="25" stroke="#112117" stroke-width="4"
                                    stroke-linecap="round" />
                                <circle class="mascot-antenna" cx="100" cy="25" r="7" fill="#ff9045" />

                                <!-- Arms -->
                                <path d="M 45 110 Q 30 110 35 80" stroke="white" stroke-linecap="round"
                                    stroke-width="12" />
                                <path class="mascot-arm-r" d="M 155 110 Q 170 110 165 130" stroke="white"
                                    stroke-linecap="round" stroke-width="12" />

                                <!-- Body -->
                                <rect class="mascot-body" x="50" y="50" width="100" height="110" rx="45" fill="white" />

                                <!-- Face -->
                                <g transform="translate(0, 10)">
                                    <!-- Eyes -->
                                    <ellipse class="mascot-eye" cx="80" cy="80" rx="10" ry="12" fill="#112117" />
                                    <ellipse class="mascot-eye" cx="120" cy="80" rx="10" ry="12" fill="#112117" />
                                    <circle cx="84" cy="76" r="3" fill="white" />
                                    <circle cx="124" cy="76" r="3" fill="white" />

                                    <!-- Blush -->
                                    <circle cx="65" cy="95" r="5" fill="#ff9045" opacity="0.4" />
                                    <circle cx="135" cy="95" r="5" fill="#ff9045" opacity="0.4" />

                                    <!-- Smile -->
                                    <path d="M 90 95 Q 100 102 110 95" fill="none" stroke="#112117"
                                        stroke-linecap="round" stroke-width="3" />
                                </g>

                                <!-- Belly panel with Braille dots -->
                                <rect x="75" y="120" width="50" height="30" rx="8" fill="#ffedd5" />
                                <circle cx="90" cy="135" r="3" fill="#ff9045" />
                                <circle cx="110" cy="135" r="3" fill="#ff9045" />
                            </g>
                        </svg>
                    </div>
                    <div class="mascot-badge">
                        <span class="badge-icon">‚†ø</span>
                    </div>
                </div>

                <!-- Text content -->
                <div class="welcome-text">
                    <h1 class="welcome-title">¬øListo para conectar<br />los puntos?</h1>
                    <p class="welcome-subtitle">√önete a la comunidad aprendiendo Braille con lecciones cortas y tu nuevo
                        mejor amigo.</p>
                </div>
            </main>

            <!-- Footer with CTA -->
            <footer class="welcome-footer">
                <button id="welcome-start-btn" class="welcome-btn primary">
                    <span>EMPEZAR</span>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7" />
                    </svg>
                </button>
            </footer>
        </section>

        <!-- Auth Screen (Magic Link Login) -->
        <section id="auth-screen" class="screen auth-screen" role="main" aria-label="Iniciar Sesi√≥n">
            <div class="welcome-bg-pattern"></div>
            <div class="welcome-glow"></div>

            <header class="auth-header">
                <button id="auth-back-btn" class="icon-btn back-btn" aria-label="Volver">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7" />
                    </svg>
                </button>
                <div class="braillito-logo">
                    <div class="braille-cell-mini">
                        <span class="dot filled"></span>
                        <span class="dot filled"></span>
                        <span class="dot filled"></span>
                        <span class="dot accent"></span>
                        <span class="dot filled"></span>
                        <span class="dot filled"></span>
                    </div>
                </div>
                <div class="spacer"></div>
            </header>

            <main class="auth-main">
                <!-- Email Input Step -->
                <div id="auth-step-email" class="auth-step active">
                    <div class="auth-icon-circle">
                        <span class="material-symbols-outlined">rocket_launch</span>
                    </div>
                    <h1 class="auth-title">Comienza tu aventura</h1>
                    <p class="auth-subtitle">Crea una cuenta para guardar tu progreso y sincronizarlo en todos tus
                        dispositivos.</p>

                    <form id="auth-form" class="auth-form">
                        <div class="auth-input-group">
                            <label for="auth-email" class="visually-hidden">Correo electr√≥nico</label>
                            <input type="email" id="auth-email" class="auth-input" placeholder="tu@correo.com" required
                                autocomplete="email" inputmode="email">
                        </div>
                        <button type="submit" id="auth-submit-btn" class="welcome-btn primary">
                            <span>Continuar con Email</span>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 12h14M12 5l7 7-7 7" />
                            </svg>
                        </button>
                    </form>

                    <!-- Divider -->
                    <div class="auth-divider">
                        <span>o</span>
                    </div>

                    <!-- Google Sign In -->
                    <button id="auth-google-btn" class="auth-google-btn">
                        <svg class="google-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
                                fill="#4285F4" />
                            <path
                                d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                                fill="#34A853" />
                            <path
                                d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                                fill="#FBBC05" />
                            <path
                                d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                                fill="#EA4335" />
                        </svg>
                        <span>Continuar con Google</span>
                    </button>

                    <button id="auth-guest-btn" class="auth-guest-btn">
                        <span>Continuar sin cuenta</span>
                        <span class="material-symbols-outlined">arrow_forward</span>
                    </button>

                    <p id="auth-error" class="auth-error hidden"></p>
                </div>

                <!-- Check Email Step -->
                <div id="auth-step-sent" class="auth-step">
                    <div class="auth-icon-circle success">
                        <span class="material-symbols-outlined">mark_email_read</span>
                    </div>
                    <h1 class="auth-title">¬°Revisa tu correo!</h1>
                    <p class="auth-subtitle">Te enviamos un enlace m√°gico a <strong id="auth-sent-email"></strong>. Haz
                        clic en el enlace para iniciar sesi√≥n.</p>

                    <div class="auth-hint">
                        <span class="material-symbols-outlined">info</span>
                        <span>Si no lo ves, revisa tu carpeta de spam.</span>
                    </div>

                    <button id="auth-resend-btn" class="welcome-btn secondary">
                        Reenviar enlace
                    </button>
                </div>

                <!-- Loading State -->
                <div id="auth-step-loading" class="auth-step">
                    <div class="auth-loader">
                        <div class="loader-spinner"></div>
                    </div>
                    <p class="auth-subtitle">Enviando enlace m√°gico...</p>
                </div>
            </main>
        </section>

        <!-- Onboarding Screen -->

        <section id="onboarding-screen" class="screen" role="main" aria-label="Configuraci√≥n de Accesibilidad">
            <div class="screen-content">
                <div class="onboarding-header">
                    <h1>Bienvenido a Braillito</h1>
                    <p>Configuremos tu experiencia para la mejor accesibilidad.</p>
                </div>

                <div class="settings-group" role="group" aria-label="Configuraci√≥n de accesibilidad">
                    <!-- Screen Reader -->
                    <div class="setting-item">
                        <div class="setting-info">
                            <label for="screen-reader-toggle" class="setting-label">Modo Lector de Pantalla</label>
                            <p class="setting-description">Activa gu√≠a de audio adicional</p>
                        </div>
                        <button id="screen-reader-toggle" class="toggle-switch" role="switch" aria-checked="false"
                            aria-label="Modo lector de pantalla">
                            <span class="toggle-track">
                                <span class="toggle-thumb"></span>
                            </span>
                        </button>
                    </div>

                    <!-- Haptic Feedback -->
                    <div class="setting-item">
                        <div class="setting-info">
                            <label for="haptic-toggle" class="setting-label">Retroalimentaci√≥n H√°ptica</label>
                            <p class="setting-description">Siente los patrones Braille con vibraciones</p>
                        </div>
                        <button id="haptic-toggle" class="toggle-switch" role="switch" aria-checked="true"
                            aria-label="Retroalimentaci√≥n h√°ptica">
                            <span class="toggle-track">
                                <span class="toggle-thumb"></span>
                            </span>
                        </button>
                    </div>

                    <!-- High Contrast -->
                    <div class="setting-item">
                        <div class="setting-info">
                            <label for="contrast-toggle" class="setting-label">Alto Contraste</label>
                            <p class="setting-description">Aumenta la claridad visual</p>
                        </div>
                        <button id="contrast-toggle" class="toggle-switch" role="switch" aria-checked="false"
                            aria-label="Modo alto contraste">
                            <span class="toggle-track">
                                <span class="toggle-thumb"></span>
                            </span>
                        </button>
                    </div>

                    <!-- Font Size -->
                    <div class="setting-item">
                        <div class="setting-info">
                            <label for="font-size-select" class="setting-label">Tama√±o del Texto</label>
                            <p class="setting-description">Elige tu tama√±o de texto preferido</p>
                        </div>
                        <div class="size-selector" role="radiogroup" aria-label="Tama√±o del texto">
                            <button class="size-option" role="radio" aria-checked="false" data-size="normal">A</button>
                            <button class="size-option active" role="radio" aria-checked="true"
                                data-size="large">A</button>
                            <button class="size-option" role="radio" aria-checked="false"
                                data-size="extra-large">A</button>
                        </div>
                    </div>
                </div>

                <button id="onboarding-continue" class="btn btn-primary btn-large">
                    Continuar
                    <span class="btn-icon" aria-hidden="true">‚Üí</span>
                </button>
            </div>
        </section>

        <!-- Profile Setup Screen -->
        <section id="profile-screen" class="screen auth-screen" role="main" aria-label="Crear Perfil">
            <div class="welcome-bg-pattern"></div>
            <div class="welcome-glow"></div>

            <header class="auth-header">
                <div class="braillito-logo">
                    <div class="braille-cell-mini">
                        <span class="dot filled"></span>
                        <span class="dot filled"></span>
                        <span class="dot filled"></span>
                        <span class="dot accent"></span>
                        <span class="dot filled"></span>
                        <span class="dot filled"></span>
                    </div>
                </div>
            </header>

            <main class="auth-main">
                <!-- Step 1: Basic Profile -->
                <div id="profile-step-1" class="profile-step active">
                    <h1 class="auth-title">Ay√∫danos a personalizar tu experiencia</h1>

                    <div class="profile-form">
                        <!-- Field 1: Name -->
                        <div class="auth-input-group">
                            <label for="profile-name" class="settings-section-title-new"
                                style="margin-left: 0; text-align: left;">¬øC√≥mo te gustar√≠a que te llamemos?</label>
                            <input type="text" id="profile-name" class="auth-input" placeholder="Tu nombre o apodo"
                                maxlength="15">
                        </div>

                        <!-- Field 2: Role -->
                        <div class="selection-group">
                            <label class="settings-section-title-new" style="margin-left: 0; text-align: left;">¬øC√≥mo
                                usar√°s Braillito?</label>
                            <div class="card-grid" id="profile-role-grid">
                                <button class="card-option" data-role="myself">
                                    <span class="option-icon">üë§</span>
                                    <span class="option-label">Para m√≠</span>
                                </button>
                                <button class="card-option" data-role="teach">
                                    <span class="option-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
                                    <span class="option-label">Ense√±ar a alguien</span>
                                </button>
                                <button class="card-option" data-role="teacher">
                                    <span class="option-icon">üßë‚Äçüè´</span>
                                    <span class="option-label">Soy educador</span>
                                </button>
                                <button class="card-option" data-role="caregiver">
                                    <span class="option-icon">‚ù§Ô∏è</span>
                                    <span class="option-label">Familiar / Cuidador</span>
                                </button>
                            </div>
                        </div>

                        <!-- Field 3: Experience -->
                        <div class="selection-group">
                            <label class="settings-section-title-new" style="margin-left: 0; text-align: left;">¬øQu√©
                                experiencia tienes con el Braille?</label>
                            <div class="card-grid" id="profile-exp-grid">
                                <button class="card-option" data-exp="scratch">
                                    <span class="option-icon">üå±</span>
                                    <span class="option-label">Desde cero</span>
                                </button>
                                <button class="card-option" data-exp="basics">
                                    <span class="option-icon">üåø</span>
                                    <span class="option-label">S√© lo b√°sico</span>
                                </button>
                                <button class="card-option" data-exp="advanced">
                                    <span class="option-icon">üå≥</span>
                                    <span class="option-label">Ya leo Braille</span>
                                </button>
                            </div>
                        </div>

                        <button id="profile-step-1-continue" class="welcome-btn primary">
                            <span>Continuar</span>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 12h14M12 5l7 7-7 7" />
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Step 2: Personalization (Optional) -->
                <div id="profile-step-2" class="profile-step">
                    <p class="auth-subtitle">Opcional ‚Äî puedes omitir esto por ahora</p>

                    <div class="profile-form">
                        <!-- Field 4: Goals -->
                        <div class="selection-group">
                            <label class="settings-section-title-new" style="margin-left: 0; text-align: left;">¬øQu√© te
                                gustar√≠a lograr?</label>
                            <div class="card-grid multi-select" id="profile-goals-grid">
                                <button class="card-option" data-goal="read">Leer palabras</button>
                                <button class="card-option" data-goal="help">Ayudar a otros</button>
                                <button class="card-option" data-goal="mind">Ejercitar la mente</button>
                                <button class="card-option" data-goal="curiosity">Por curiosidad</button>
                            </div>
                        </div>

                        <!-- Field 5: Preferences -->
                        <div class="selection-group">
                            <label class="settings-section-title-new" style="margin-left: 0; text-align: left;">¬øC√≥mo
                                prefieres aprender?</label>
                            <div class="card-grid multi-select" id="profile-prefs-grid">
                                <button class="card-option" data-pref="lessons">üìò Lecciones</button>
                                <button class="card-option" data-pref="games">üéÆ Juegos</button>
                                <button class="card-option" data-pref="repetition">üîÅ Repetici√≥n</button>
                                <button class="card-option" data-pref="challenges">üß© Desaf√≠os</button>
                            </div>
                        </div>

                        <footer class="welcome-footer" style="padding: 0; margin-top: 2rem;">
                            <button id="profile-finish" class="welcome-btn primary">
                                <span>Empezar a aprender</span>
                            </button>
                            <button id="profile-skip" class="welcome-btn secondary"
                                style="margin-top: 1rem; border: none; background: transparent; color: var(--color-text-muted); text-transform: none; letter-spacing: normal;">
                                Omitir por ahora
                            </button>
                        </footer>
                    </div>
                </div>
            </main>
        </section>

        <!-- Home Dashboard (New Braillito Design) -->
        <section id="dashboard-screen" class="screen dashboard-new" role="main" aria-label="Panel Principal">
            <!-- Background elements -->
            <div class="welcome-bg-pattern"></div>
            <div class="welcome-glow"></div>

            <!-- Header -->
            <header class="dashboard-header-new">
                <div class="braillito-logo">
                    <div class="braille-cell-mini">
                        <span class="dot filled"></span>
                        <span class="dot filled"></span>
                        <span class="dot filled"></span>
                        <span class="dot accent"></span>
                        <span class="dot filled"></span>
                        <span class="dot filled"></span>
                    </div>
                    <h2 class="braillito-text">Braillito</h2>
                </div>
                <div class="header-actions">
                    <div class="streak-pill">
                        <span class="streak-icon">üî•</span>
                        <span id="streak-count" class="streak-num">1</span>
                    </div>
                    <div class="avatar-circle" id="user-avatar">
                        <span id="avatar-initials">AP</span>
                    </div>
                </div>
            </header>

            <!-- Main Content -->
            <main class="dashboard-main">
                <!-- Welcome Card -->
                <div class="welcome-card">
                    <div class="welcome-card-content">
                        <h1 id="greeting-text" class="greeting-new">¬°Hola, Aprendiz!</h1>
                        <p class="greeting-sub">¬°Sigue aprendiendo hoy!</p>
                        <div class="trend-badge">
                            <span class="trend-icon">üìà</span>
                            <span class="trend-text">+25% esta semana</span>
                        </div>
                    </div>
                    <div class="welcome-mascot-mini">
                        <svg class="robot-svg-mini" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                            <g>
                                <line x1="100" y1="50" x2="100" y2="25" stroke="#112117" stroke-width="4"
                                    stroke-linecap="round" />
                                <circle class="mascot-antenna" cx="100" cy="25" r="7" fill="#ff9045" />
                                <path d="M 45 110 Q 30 110 35 80" stroke="white" stroke-linecap="round"
                                    stroke-width="12" />
                                <path class="mascot-arm-r" d="M 155 110 Q 170 110 165 130" stroke="white"
                                    stroke-linecap="round" stroke-width="12" />
                                <rect x="50" y="50" width="100" height="110" rx="45" fill="white" />
                                <g transform="translate(0, 10)">
                                    <ellipse class="mascot-eye" cx="80" cy="80" rx="10" ry="12" fill="#112117" />
                                    <ellipse class="mascot-eye" cx="120" cy="80" rx="10" ry="12" fill="#112117" />
                                    <circle cx="84" cy="76" r="3" fill="white" />
                                    <circle cx="124" cy="76" r="3" fill="white" />
                                    <circle cx="65" cy="95" r="5" fill="#ff9045" opacity="0.4" />
                                    <circle cx="135" cy="95" r="5" fill="#ff9045" opacity="0.4" />
                                    <path d="M 90 95 Q 100 102 110 95" fill="none" stroke="#112117"
                                        stroke-linecap="round" stroke-width="3" />
                                </g>
                                <rect x="75" y="120" width="50" height="30" rx="8" fill="#ffedd5" />
                                <circle cx="90" cy="135" r="3" fill="#ff9045" />
                                <circle cx="110" cy="135" r="3" fill="#ff9045" />
                            </g>
                        </svg>
                    </div>
                </div>

                <!-- Continue Learning Section -->
                <div class="section-label">Continuar Aprendiendo</div>
                <button id="continue-btn" class="continue-card">
                    <div class="continue-card-inner">
                        <div class="continue-header">
                            <span class="level-badge">Nivel <span id="current-level-num">1</span></span>
                            <div class="play-btn-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M8 5v14l11-7z" />
                                </svg>
                            </div>
                        </div>
                        <h2 class="continue-level-title" id="continue-level-title">El Alfabeto</h2>
                        <p class="continue-lesson" id="continue-desc">Lecci√≥n 2: Letras D - F</p>
                        <div class="progress-section">
                            <div class="progress-labels">
                                <span>Tu Progreso</span>
                                <span id="progress-percent">0%</span>
                            </div>
                            <div class="progress-track">
                                <div id="progress-bar" class="progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="continue-bg-icon">‚†ø</div>
                </button>

                <!-- Stats Grid -->
                <div class="stats-grid-new">
                    <div class="stat-card-new blue">
                        <div class="stat-icon-circle">üìö</div>
                        <div class="stat-info">
                            <span id="levels-completed" class="stat-value-new">0</span>
                            <span class="stat-label-new">Lecciones</span>
                        </div>
                    </div>
                    <div class="stat-card-new purple">
                        <div class="stat-icon-circle">üèÜ</div>
                        <div class="stat-info">
                            <span id="total-xp" class="stat-value-new">0</span>
                            <span class="stat-label-new">Puntos XP</span>
                        </div>
                    </div>
                </div>

                <!-- Achievements Section -->
                <div class="section-label">Pr√≥ximos Logros</div>
                <div class="achievements-preview" id="next-achievements">
                    <div class="achievement-row locked">
                        <div class="achievement-icon-box">üîí</div>
                        <div class="achievement-info">
                            <h4>Maestro de N√∫meros</h4>
                            <p>Completa el M√≥dulo 2</p>
                        </div>
                    </div>
                    <div class="achievement-row locked">
                        <div class="achievement-icon-box">üîí</div>
                        <div class="achievement-info">
                            <h4>Lector Veloz</h4>
                            <p>Lee 5 frases en 1 minuto</p>
                        </div>
                    </div>
                </div>

                <!-- Native Ad Banner (Dashboard Bottom) -->
                <div class="ad-container">
                    <div class="native-ad-banner" style="background: #fff; border: 1px solid #eee;">
                        <span class="ad-badge">Patrocinado</span>
                        <div class="native-ad-content"
                            style="flex-direction: row; justify-content: space-between; align-items: center;">
                            <img src="/public/ad-uchile.png" alt="Universidad de Chile Logo"
                                style="height: 50px; width: auto; object-fit: contain; margin-right: 12px;">
                            <div style="flex:1; text-align: left;">
                                <div class="ad-title" style="font-size: 0.85rem;">Universidad de Chile</div>
                                <div class="ad-desc">Excelencia y tradici√≥n.</div>
                            </div>
                            <div class="ad-cta">VER M√ÅS</div>
                        </div>
                    </div>
                </div>
            </main>
        </section>

        <!-- Levels Screen (New Braillito Design) -->
        <section id="levels-screen" class="screen levels-new" role="main" aria-label="Tu Aventura">
            <!-- Background elements -->
            <div class="welcome-bg-pattern"></div>
            <div class="welcome-glow"></div>

            <!-- Fixed Header -->
            <header class="levels-header-new">
                <div class="braillito-logo">
                    <div class="braille-cell-mini">
                        <span class="dot filled"></span>
                        <span class="dot filled"></span>
                        <span class="dot filled"></span>
                        <span class="dot accent"></span>
                        <span class="dot filled"></span>
                        <span class="dot filled"></span>
                    </div>
                </div>
                <div class="header-stats">
                    <div class="stat-pill bolt">
                        <span class="stat-emoji">‚ö°</span>
                        <span class="stat-num" id="energy-count">3</span>
                    </div>
                    <div class="stat-pill heart">
                        <span class="stat-emoji">‚ù§Ô∏è</span>
                        <span class="stat-num" id="lives-count">5</span>
                    </div>
                </div>
            </header>

            <!-- Main Content -->
            <main class="levels-main">
                <!-- Levels will be generated dynamically by JS -->
                <div id="levels-list" class="levels-list">
                    <!-- Chapter sections will be inserted here -->
                </div>
            </main>
        </section>

        <!-- Practice Mode Setup Screen -->
        <section id="practice-screen" class="screen" role="main" aria-label="Configuraci√≥n del Modo Pr√°ctica">
            <header class="screen-header">
                <button id="practice-back-btn" class="icon-btn back-btn" aria-label="Volver al panel">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7" />
                    </svg>
                </button>
                <h1>Modo Pr√°ctica</h1>
                <div class="spacer"></div>
            </header>

            <div class="practice-setup-content">
                <p class="practice-intro">Personaliza tu sesi√≥n de pr√°ctica para enfocarte en lo que quieres aprender.
                </p>

                <!-- Game Type Selection -->
                <div class="setup-section">
                    <h2 class="setup-section-title">Tipo de Juego</h2>
                    <div class="game-type-options" role="radiogroup" aria-label="Selecciona el tipo de juego">
                        <button class="game-type-option active" role="radio" aria-checked="true" data-type="build">
                            <span class="type-icon">‚úèÔ∏è</span>
                            <span class="type-name">Construir Letras</span>
                            <span class="type-desc">Toca los puntos para crear patrones Braille</span>
                        </button>
                        <button class="game-type-option" role="radio" aria-checked="false" data-type="pick">
                            <span class="type-icon">üëÜ</span>
                            <span class="type-name">Elegir la Celda</span>
                            <span class="type-desc">Elige el patr√≥n correcto</span>
                        </button>
                        <button class="game-type-option" role="radio" aria-checked="false" data-type="mixed">
                            <span class="type-icon">üîÄ</span>
                            <span class="type-name">Modo Mixto</span>
                            <span class="type-desc">Alterna entre ambos juegos</span>
                        </button>
                    </div>
                </div>

                <!-- Letter Selection -->
                <div class="setup-section">
                    <h2 class="setup-section-title">Letras para Practicar</h2>
                    <div class="letter-filter-options" role="radiogroup" aria-label="Selecciona las letras a practicar">
                        <button class="letter-filter-option active" role="radio" aria-checked="true"
                            data-filter="learned">
                            <span class="filter-icon">üìö</span>
                            <span class="filter-name">Todas las Aprendidas</span>
                            <span id="learned-count" class="filter-count">3 letras</span>
                        </button>
                        <button class="letter-filter-option" role="radio" aria-checked="false" data-filter="vowels">
                            <span class="filter-icon">üî§</span>
                            <span class="filter-name">Solo Vocales</span>
                            <span class="filter-count">A, E, I, O, U</span>
                        </button>
                        <button class="letter-filter-option" role="radio" aria-checked="false" data-filter="recent">
                            <span class="filter-icon">üïê</span>
                            <span class="filter-name">Letras Recientes</span>
                            <span class="filter-count">√öltimas 5 aprendidas</span>
                        </button>
                        <button class="letter-filter-option" role="radio" aria-checked="false" data-filter="custom">
                            <span class="filter-icon">‚öôÔ∏è</span>
                            <span class="filter-name">Selecci√≥n Personalizada</span>
                            <span class="filter-count">Elige letras espec√≠ficas</span>
                        </button>
                    </div>

                    <!-- Custom Letter Picker (hidden by default) -->
                    <div id="custom-letter-picker" class="custom-letter-picker hidden">
                        <p class="picker-label">Selecciona las letras para practicar:</p>
                        <div id="letter-grid" class="letter-grid" role="group" aria-label="Letras disponibles">
                            <!-- Generated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Session Options -->
                <div class="setup-section">
                    <h2 class="setup-section-title">Opciones de Sesi√≥n</h2>

                    <div class="session-options">
                        <!-- Number of Rounds -->
                        <div class="option-row">
                            <span class="option-label">N√∫mero de Rondas</span>
                            <div class="round-selector" role="group" aria-label="N√∫mero de rondas">
                                <button class="round-option" data-rounds="5">5</button>
                                <button class="round-option active" data-rounds="10">10</button>
                                <button class="round-option" data-rounds="15">15</button>
                                <button class="round-option" data-rounds="20">20</button>
                            </div>
                        </div>

                        <!-- Timed Mode -->
                        <div class="option-row">
                            <div class="option-info">
                                <span class="option-label">Modo Cronometrado</span>
                                <span class="option-desc">10 segundos por pregunta</span>
                            </div>
                            <button id="practice-timed-toggle" class="toggle-switch" role="switch" aria-checked="false">
                                <span class="toggle-track"><span class="toggle-thumb"></span></span>
                            </button>
                        </div>

                        <!-- Show Hints -->
                        <div class="option-row">
                            <div class="option-info">
                                <span class="option-label">Permitir Pistas</span>
                                <span class="option-desc">Accede a pistas durante la pr√°ctica</span>
                            </div>
                            <button id="practice-hints-toggle" class="toggle-switch" role="switch" aria-checked="true">
                                <span class="toggle-track"><span class="toggle-thumb"></span></span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Start Button -->
                <button id="start-practice-btn" class="btn btn-primary btn-large">
                    Iniciar Pr√°ctica
                    <span class="btn-icon" aria-hidden="true">‚Üí</span>
                </button>
            </div>
        </section>

        <!-- Lesson Intro Screen - New Pre-Lesson Design -->
        <section id="lesson-intro-screen" class="screen pre-lesson-screen" role="main"
            aria-label="Introducci√≥n a la Lecci√≥n">
            <!-- Fixed Header -->
            <header class="pre-lesson-header">
                <button id="lesson-back-btn" class="pre-lesson-back-btn back-btn" aria-label="Volver a los niveles">
                    <span class="material-symbols-outlined">arrow_back</span>
                </button>


                <div class="spacer"></div>
            </header>

            <!-- Top Section: Floating Mascot -->
            <div class="pre-lesson-mascot-area">
                <div class="pre-lesson-mascot-container">
                    <div class="mascot-speech-bubble">
                        <span id="intro-puppy-message">¬°T√∫ puedes!</span>
                    </div>
                    <div class="mascot-glow"></div>
                    <div class="pre-lesson-mascot-figure">
                        <!-- New Pet Mascot SVG -->
                        <svg class="pre-lesson-pet-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <filter height="140%" id="soft-shadow-prelesson" width="140%" x="-20%" y="-20%">
                                    <feGaussianBlur in="SourceAlpha" stdDeviation="2"></feGaussianBlur>
                                    <feOffset dx="0" dy="3" result="offsetblur"></feOffset>
                                    <feComponentTransfer>
                                        <feFuncA slope="0.15" type="linear"></feFuncA>
                                    </feComponentTransfer>
                                    <feMerge>
                                        <feMergeNode></feMergeNode>
                                        <feMergeNode in="SourceGraphic"></feMergeNode>
                                    </feMerge>
                                </filter>
                            </defs>
                            <g filter="url(#soft-shadow-prelesson)">
                                <!-- Antenna -->
                                <line stroke="#112117" stroke-linecap="round" stroke-width="4" x1="100" x2="100" y1="50"
                                    y2="25"></line>
                                <circle class="mascot-antenna" cx="100" cy="25" fill="#ff9045" r="7"></circle>
                                <!-- Arms -->
                                <path class="mascot-arm-r" d="M 45 110 Q 30 110 35 80" stroke="white"
                                    stroke-linecap="round" stroke-width="12"></path>
                                <path d="M 155 110 Q 170 110 165 130" stroke="white" stroke-linecap="round"
                                    stroke-width="12"></path>
                                <!-- Body -->
                                <rect class="mascot-body" fill="white" height="110" rx="45" width="100" x="50" y="50">
                                </rect>
                                <!-- Face -->
                                <g transform="translate(0, 10)">
                                    <!-- Eyes -->
                                    <ellipse class="mascot-eye" cx="80" cy="80" fill="#112117" rx="10" ry="12">
                                    </ellipse>
                                    <ellipse class="mascot-eye" cx="120" cy="80" fill="#112117" rx="10" ry="12">
                                    </ellipse>
                                    <circle cx="84" cy="76" fill="white" r="3"></circle>
                                    <circle cx="124" cy="76" fill="white" r="3"></circle>
                                    <!-- Blush -->
                                    <circle cx="65" cy="95" fill="#ff9045" opacity="0.4" r="5"></circle>
                                    <circle cx="135" cy="95" fill="#ff9045" opacity="0.4" r="5"></circle>
                                    <!-- Smile -->
                                    <path d="M 90 95 Q 100 102 110 95" fill="none" stroke="#112117"
                                        stroke-linecap="round" stroke-width="3"></path>
                                </g>
                                <!-- Belly panel with Braille dots -->
                                <rect fill="#ffedd5" height="30" rx="8" width="50" x="75" y="120"></rect>
                                <circle cx="90" cy="135" fill="#ff9045" r="3"></circle>
                                <circle cx="110" cy="135" fill="#ff9045" r="3"></circle>
                            </g>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Bottom Sheet -->
            <div class="pre-lesson-sheet">
                <div class="sheet-handle"></div>

                <div class="sheet-content">
                    <!-- Lesson Badge -->
                    <div class="lesson-badge">
                        <span class="material-symbols-outlined filled">school</span>
                        <span id="lesson-number-badge">Lecci√≥n 1</span>
                    </div>

                    <!-- Lesson Title -->
                    <h1 id="lesson-subtitle" class="pre-lesson-title">Conoce la Celda Braille</h1>

                    <!-- Estimated Time -->
                    <div class="lesson-time">
                        <span class="material-symbols-outlined">timer</span>
                        <span id="lesson-time-estimate">3 minutos estimados</span>
                    </div>

                    <hr class="sheet-divider" />

                    <!-- Description -->
                    <p id="lesson-description" class="pre-lesson-desc">
                        Una celda Braille tiene 6 puntos ordenados en 2 columnas.
                        Los puntos 1, 2, 3 est√°n a la izquierda. Los puntos 4, 5, 6 est√°n a la derecha.
                        ¬°Aprendamos a construir tus primeras letras!
                    </p>

                    <!-- Native Ad Banner (Replacing Tips) -->
                    <div class="ad-container">
                        <div class="native-ad-banner" style="background: white; border: 1px solid #eee;">
                            <span class="ad-badge">Patrocinado</span>
                            <div class="native-ad-content" style="flex-direction: row; gap: 16px;">
                                <img src="/public/ad-utm.png" alt="UTM Logo"
                                    style="height: 50px; width: auto; object-fit: contain;">
                                <div style="flex:1; text-align: left;">
                                    <div class="ad-title" style="font-size: 0.9rem;">Universidad Tecnol√≥gica
                                        Metropolitana</div>
                                    <div class="ad-desc">Formando profesionales con futuro.</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Start Button -->
                    <button id="start-lesson-btn" class="pre-lesson-start-btn">
                        <span>Comenzar Lecci√≥n</span>
                        <span class="material-symbols-outlined filled">arrow_forward</span>
                    </button>
                </div>
            </div>
        </section>


        <!-- Instruction Screen - New Lesson Design -->
        <section id="instruction-screen" class="screen lesson-screen-new lesson-shell" role="main"
            aria-label="Fase de Aprendizaje">
            <!-- Header with progress bar and lives -->
            <header class="lesson-header-new">
                <button id="instruction-skip-btn" class="lesson-close-btn" aria-label="Cerrar lecci√≥n">
                    <span class="material-symbols-outlined">close</span>
                </button>
                <div class="lesson-progress-bar-container">
                    <div id="lesson-progress-bar" class="lesson-progress-bar-fill" style="width: 0%">
                        <div class="lesson-progress-shine"></div>
                    </div>
                </div>
                <button class="lesson-audio-toggle" aria-label="Toggle lesson audio" aria-checked="true">
                    <span class="material-symbols-outlined">volume_up</span>
                </button>
            </header>

            <!-- Main Content -->
            <main class="lesson-main-content">
                <h1 class="lesson-phase-title">Observa y Recuerda</h1>

                <div class="lesson-content-area">
                    <!-- Pet mascot with speech bubble -->
                    <div class="lesson-mascot-row">
                        <div class="lesson-mascot-mini">
                            <svg class="lesson-pet-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <filter height="140%" id="lesson-shadow" width="140%" x="-20%" y="-20%">
                                        <feGaussianBlur in="SourceAlpha" stdDeviation="2"></feGaussianBlur>
                                        <feOffset dx="0" dy="3" result="offsetblur"></feOffset>
                                        <feComponentTransfer>
                                            <feFuncA slope="0.15" type="linear"></feFuncA>
                                        </feComponentTransfer>
                                        <feMerge>
                                            <feMergeNode></feMergeNode>
                                            <feMergeNode in="SourceGraphic"></feMergeNode>
                                        </feMerge>
                                    </filter>
                                </defs>
                                <g filter="url(#lesson-shadow)">
                                    <!-- Antenna -->
                                    <line stroke="#112117" stroke-linecap="round" stroke-width="4" x1="100" x2="100"
                                        y1="50" y2="25"></line>
                                    <circle class="mascot-antenna" cx="100" cy="25" fill="#ff9045" r="7"></circle>
                                    <!-- Arms -->
                                    <path d="M 45 110 Q 30 110 35 80" stroke="white" stroke-linecap="round"
                                        stroke-width="12"></path>
                                    <path class="mascot-arm-r" d="M 155 110 Q 170 110 165 130" stroke="white"
                                        stroke-linecap="round" stroke-width="12"></path>
                                    <!-- Body -->
                                    <rect class="mascot-body" fill="white" height="110" rx="45" width="100" x="50"
                                        y="50"></rect>
                                    <!-- Face -->
                                    <g transform="translate(0, 10)">
                                        <ellipse class="mascot-eye" cx="80" cy="80" fill="#112117" rx="10" ry="12">
                                        </ellipse>
                                        <ellipse class="mascot-eye" cx="120" cy="80" fill="#112117" rx="10" ry="12">
                                        </ellipse>
                                        <circle cx="84" cy="76" fill="white" r="3"></circle>
                                        <circle cx="124" cy="76" fill="white" r="3"></circle>
                                        <circle cx="65" cy="95" fill="#ff9045" opacity="0.4" r="5"></circle>
                                        <circle cx="135" cy="95" fill="#ff9045" opacity="0.4" r="5"></circle>
                                        <path d="M 90 95 Q 100 102 110 95" fill="none" stroke="#112117"
                                            stroke-linecap="round" stroke-width="3"></path>
                                    </g>
                                    <!-- Belly panel with Braille dots -->
                                    <rect x="75" y="120" width="50" height="30" rx="8" fill="#ffedd5"></rect>
                                    <circle cx="90" cy="135" r="3" fill="#ff9045"></circle>
                                    <circle cx="110" cy="135" r="3" fill="#ff9045"></circle>
                                </g>
                            </svg>
                        </div>
                        <div class="lesson-speech-bubble">
                            <p id="instruction-puppy-message">Aprendamos la <span id="instruction-letter"
                                    class="lesson-letter-highlight">...</span></p>
                            <div class="lesson-bubble-tail"></div>
                        </div>
                    </div>

                    <!-- Braille Cell with Glow Effect - Single large cell -->
                    <div class="lesson-braille-container">
                        <div class="lesson-braille-cell-single" id="instruction-cell-container">
                            <!-- Hidden prefix cell for capital letters/numbers (Now first in DOM for Left display) -->
                            <div class="braille-lesson-cell hidden" id="instruction-cell-prefix">
                                <button class="braille-lesson-dot" data-dot="1" aria-label="Punto 1">1</button>
                                <button class="braille-lesson-dot" data-dot="4" aria-label="Punto 4">4</button>
                                <button class="braille-lesson-dot" data-dot="2" aria-label="Punto 2">2</button>
                                <button class="braille-lesson-dot" data-dot="5" aria-label="Punto 5">5</button>
                                <button class="braille-lesson-dot" data-dot="3" aria-label="Punto 3">3</button>
                                <button class="braille-lesson-dot" data-dot="6" aria-label="Punto 6">6</button>
                            </div>
                            <div class="braille-lesson-cell" id="instruction-cell">
                                <button class="braille-lesson-dot" data-dot="1" aria-label="Punto 1">1</button>
                                <button class="braille-lesson-dot" data-dot="4" aria-label="Punto 4">4</button>
                                <button class="braille-lesson-dot" data-dot="2" aria-label="Punto 2">2</button>
                                <button class="braille-lesson-dot" data-dot="5" aria-label="Punto 5">5</button>
                                <button class="braille-lesson-dot" data-dot="3" aria-label="Punto 3">3</button>
                                <button class="braille-lesson-dot" data-dot="6" aria-label="Punto 6">6</button>
                            </div>
                        </div>
                    </div>

                    <!-- Hidden elements for JS updates -->
                    <span id="instruction-letter-large" class="hidden">A</span>
                    <p id="instruction-text" class="sr-only">A es el punto 1</p>
                    <div id="instruction-progress-dots" class="sr-only"></div>
                </div>
            </main>

            <!-- Footer with buttons -->
            <footer class="lesson-footer-new">
                <button id="instruction-repeat-btn" class="lesson-btn-secondary"
                    aria-label="Repetir animaci√≥n de ense√±anza">
                    REPETIR
                </button>
                <button id="instruction-next-btn" class="lesson-btn-primary">
                    SIGUIENTE
                </button>
            </footer>
        </section>

        <!-- Build Letter Game Screen -->
        <section id="game-build-screen" class="screen lesson-screen-new lesson-shell" role="main"
            aria-label="Juego Construye la Letra">
            <!-- Background decorations -->
            <div class="pick-bg-pattern"></div>
            <div class="pick-bg-glow"></div>

            <!-- Header -->
            <header class="lesson-header-new">
                <button id="game-exit-btn" class="lesson-close-btn" aria-label="Cerrar juego">
                    <span class="material-symbols-outlined">close</span>
                </button>
                <div class="lesson-progress-bar-container">
                    <div id="game-progress-fill" class="lesson-progress-bar-fill" style="width: 20%">
                        <div class="lesson-progress-shine"></div>
                    </div>
                    <span id="game-progress-text" class="sr-only">1 / 10</span>
                </div>
                <button class="lesson-audio-toggle" aria-label="Toggle lesson audio" aria-checked="true">
                    <span class="material-symbols-outlined">volume_up</span>
                </button>
            </header>

            <!-- Main Content -->
            <main class="lesson-main-content">
                <div class="lesson-content-area">
                    <!-- Pet mascot with speech bubble -->
                    <div class="lesson-mascot-row">
                        <div class="lesson-mascot-mini">
                            <svg class="lesson-pet-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <filter height="140%" id="soft-shadow-robot-build" width="140%" x="-20%" y="-20%">
                                        <feGaussianBlur in="SourceAlpha" stdDeviation="2"></feGaussianBlur>
                                        <feOffset dx="0" dy="3" result="offsetblur"></feOffset>
                                        <feComponentTransfer>
                                            <feFuncA slope="0.15" type="linear"></feFuncA>
                                        </feComponentTransfer>
                                        <feMerge>
                                            <feMergeNode></feMergeNode>
                                            <feMergeNode in="SourceGraphic"></feMergeNode>
                                        </feMerge>
                                    </filter>
                                </defs>
                                <g filter="url(#soft-shadow-robot-build)">
                                    <!-- Antenna -->
                                    <line stroke="#112117" stroke-linecap="round" stroke-width="4" x1="100" x2="100"
                                        y1="50" y2="25"></line>
                                    <circle cx="100" cy="25" fill="#ff9045" r="7"></circle>
                                    <!-- Arms -->
                                    <path d="M 45 110 Q 30 110 35 80" stroke="white" stroke-linecap="round"
                                        stroke-width="12"></path>
                                    <path d="M 155 110 Q 170 110 165 130" stroke="white" stroke-linecap="round"
                                        stroke-width="12"></path>
                                    <!-- Body -->
                                    <rect fill="white" height="110" rx="45" width="100" x="50" y="50"></rect>
                                    <!-- Face -->
                                    <g transform="translate(0, 10)">
                                        <ellipse cx="80" cy="80" fill="#112117" rx="10" ry="12"></ellipse>
                                        <ellipse cx="120" cy="80" fill="#112117" rx="10" ry="12"></ellipse>
                                        <circle cx="84" cy="76" fill="white" r="3"></circle>
                                        <circle cx="124" cy="76" fill="white" r="3"></circle>
                                        <circle cx="65" cy="95" fill="#ff9045" opacity="0.4" r="5"></circle>
                                        <circle cx="135" cy="95" fill="#ff9045" opacity="0.4" r="5"></circle>
                                        <path d="M 90 95 Q 100 102 110 95" fill="none" stroke="#112117"
                                            stroke-linecap="round" stroke-width="3"></path>
                                    </g>
                                    <!-- Belly panel with Braille dots -->
                                    <rect x="75" y="120" width="50" height="30" rx="8" fill="#ffedd5"></rect>
                                    <circle cx="90" cy="135" r="3" fill="#ff9045"></circle>
                                    <circle cx="110" cy="135" r="3" fill="#ff9045"></circle>
                                </g>
                            </svg>
                        </div>
                        <div class="lesson-speech-bubble">
                            <p id="build-game-message">Toc√° los puntos correctos para construir la letra en Braille.</p>
                            <div class="lesson-bubble-tail"></div>
                        </div>
                    </div>

                    <!-- Large Target Letter Display -->
                    <div class="build-target-letter-display">
                        <div class="build-target-letter-circle" id="build-target-letter-circle">
                            <span id="build-target-letter">A</span>
                        </div>
                    </div>

                    <!-- Braille Cell with Glow Effect - Single large cell -->
                    <div class="lesson-braille-container">
                        <div class="lesson-braille-cell-single" id="build-cell-container">
                            <div class="braille-lesson-cell" id="braille-input">
                                <button class="braille-lesson-dot dot-btn" data-dot="1" aria-label="Punto 1">1</button>
                                <button class="braille-lesson-dot dot-btn" data-dot="4" aria-label="Punto 4">4</button>
                                <button class="braille-lesson-dot dot-btn" data-dot="2" aria-label="Punto 2">2</button>
                                <button class="braille-lesson-dot dot-btn" data-dot="5" aria-label="Punto 5">5</button>
                                <button class="braille-lesson-dot dot-btn" data-dot="3" aria-label="Punto 3">3</button>
                                <button class="braille-lesson-dot dot-btn" data-dot="6" aria-label="Punto 6">6</button>
                            </div>
                            <!-- Hidden prefix cell for capital letters/numbers -->
                            <div class="braille-lesson-cell hidden" id="build-prefix-cell">
                                <button class="braille-lesson-dot" data-dot="1" aria-label="Punto 1">1</button>
                                <button class="braille-lesson-dot" data-dot="4" aria-label="Punto 4">4</button>
                                <button class="braille-lesson-dot" data-dot="2" aria-label="Punto 2">2</button>
                                <button class="braille-lesson-dot" data-dot="5" aria-label="Punto 5">5</button>
                                <button class="braille-lesson-dot" data-dot="3" aria-label="Punto 3">3</button>
                                <button class="braille-lesson-dot" data-dot="6" aria-label="Punto 6">6</button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Footer -->
            <footer class="lesson-footer-new">
                <button id="check-answer-btn" class="lesson-btn-primary">
                    COMPROBAR
                </button>
            </footer>

            <!-- Feedback Overlay -->
            <div id="feedback-overlay" class="feedback-overlay hidden" role="alertdialog" aria-modal="true">
                <div class="feedback-content">
                    <div id="feedback-icon" class="feedback-icon" aria-hidden="true">‚úì</div>
                    <h2 id="feedback-title">¬°Correcto!</h2>
                    <p id="feedback-message">¬°Muy bien!</p>
                    <button id="feedback-continue-btn" class="btn btn-primary">Continuar</button>
                </div>
            </div>
        </section>

        <!-- Pick Cell Game Screen - New Design -->
        <section id="game-pick-screen" class="screen pick-screen-new lesson-shell" role="main"
            aria-label="Juego Elige la Celda Correcta">
            <!-- Background decorations -->
            <div class="pick-bg-pattern"></div>
            <div class="pick-bg-glow"></div>

            <!-- Header - Same as Instruction Screen -->
            <header class="lesson-header-new">
                <button id="pick-exit-btn" class="lesson-close-btn" aria-label="Salir del juego">
                    <span class="material-symbols-outlined">close</span>
                </button>
                <div class="lesson-progress-bar-container">
                    <div id="pick-progress-fill" class="lesson-progress-bar-fill" style="width: 0%">
                        <div class="lesson-progress-shine"></div>
                    </div>
                </div>
                <button class="lesson-audio-toggle" aria-label="Toggle lesson audio" aria-checked="true">
                    <span class="material-symbols-outlined">volume_up</span>
                </button>
            </header>

            <!-- Repaso 2.0 Main Content -->
            <main class="lesson-main-content">
                <h1 class="lesson-phase-title">Elige la celda correcta</h1>

                <div class="lesson-content-area">
                    <!-- Mascot and Question - Same as Instruction Screen -->
                    <div class="lesson-mascot-row">
                        <div class="lesson-mascot-mini">
                            <svg class="lesson-pet-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <filter height="140%" id="pick-lesson-shadow" width="140%" x="-20%" y="-20%">
                                        <feGaussianBlur in="SourceAlpha" stdDeviation="2"></feGaussianBlur>
                                        <feOffset dx="0" dy="3" result="offsetblur"></feOffset>
                                        <feComponentTransfer>
                                            <feFuncA slope="0.15" type="linear"></feFuncA>
                                        </feComponentTransfer>
                                        <feMerge>
                                            <feMergeNode></feMergeNode>
                                            <feMergeNode in="SourceGraphic"></feMergeNode>
                                        </feMerge>
                                    </filter>
                                </defs>
                                <g filter="url(#pick-lesson-shadow)">
                                    <!-- Antenna -->
                                    <line stroke="#112117" stroke-linecap="round" stroke-width="4" x1="100" x2="100"
                                        y1="50" y2="25"></line>
                                    <circle cx="100" cy="25" fill="#ff9045" r="7"></circle>
                                    <!-- Arms -->
                                    <path d="M 45 110 Q 30 110 35 80" stroke="white" stroke-linecap="round"
                                        stroke-width="12"></path>
                                    <path d="M 155 110 Q 170 110 165 130" stroke="white" stroke-linecap="round"
                                        stroke-width="12"></path>
                                    <!-- Body -->
                                    <rect fill="white" height="110" rx="45" width="100" x="50" y="50"></rect>
                                    <!-- Face -->
                                    <g transform="translate(0, 10)">
                                        <ellipse cx="80" cy="80" fill="#112117" rx="10" ry="12"></ellipse>
                                        <ellipse cx="120" cy="80" fill="#112117" rx="10" ry="12"></ellipse>
                                        <circle cx="84" cy="76" fill="white" r="3"></circle>
                                        <circle cx="124" cy="76" fill="white" r="3"></circle>
                                        <circle cx="65" cy="95" fill="#ff9045" opacity="0.4" r="5"></circle>
                                        <circle cx="135" cy="95" fill="#ff9045" opacity="0.4" r="5"></circle>
                                        <path d="M 90 95 Q 100 102 110 95" fill="none" stroke="#112117"
                                            stroke-linecap="round" stroke-width="3"></path>
                                    </g>
                                    <!-- Belly panel with Braille dots -->
                                    <rect x="75" y="120" width="50" height="30" rx="8" fill="#ffedd5"></rect>
                                    <circle cx="90" cy="135" r="3" fill="#ff9045"></circle>
                                    <circle cx="110" cy="135" r="3" fill="#ff9045"></circle>
                                </g>
                            </svg>
                        </div>
                        <div class="lesson-speech-bubble">
                            <p id="pick-game-message">¬øCu√°l de estas es la <span id="pick-target-letter"
                                    class="lesson-letter-highlight">letra
                                    a</span>?</p>
                            <div class="lesson-bubble-tail"></div>
                        </div>
                    </div>

                    <!-- Repaso 2.0 Options Grid -->
                    <div id="options-grid" class="pick-v2-options-grid" role="radiogroup"
                        aria-label="Opciones de respuesta">
                        <!-- Options populated by JS -->
                    </div>
                </div>
            </main>

            <!-- Footer - Same style as other lesson screens -->
            <footer class="lesson-footer-new">
                <button id="pick-check-btn" class="lesson-btn-primary" disabled>
                    COMPROBAR
                </button>
            </footer>
        </section>

        <!-- Results Screen -->
        <section id="results-screen" class="screen level-complete-screen" role="main" aria-label="Resultados del Nivel">
            <div class="level-pattern"></div>
            <div class="level-bg-glow glow-orange"></div>
            <div class="level-bg-glow glow-purple"></div>

            <div class="level-complete-wrapper">
                <div class="level-stars" aria-hidden="true">
                    <div class="level-stars-container" id="stars-container" role="img"
                        aria-label="2 de 3 estrellas ganadas">
                        <span class="result-star earned">‚≠ê</span>
                        <span class="result-star earned">‚≠ê</span>
                        <span class="result-star">‚òÜ</span>
                    </div>
                </div>

                <div class="level-mascot">
                    <div class="level-mascot-circle">
                        <svg class="level-mascot-svg" fill="none" viewBox="0 0 200 200"
                            xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <filter height="140%" id="level-soft-shadow" width="140%" x="-20%" y="-20%">
                                    <feGaussianBlur in="SourceAlpha" stdDeviation="2"></feGaussianBlur>
                                    <feOffset dx="0" dy="3" result="offsetblur"></feOffset>
                                    <feComponentTransfer>
                                        <feFuncA slope="0.15" type="linear"></feFuncA>
                                    </feComponentTransfer>
                                    <feMerge>
                                        <feMergeNode></feMergeNode>
                                        <feMergeNode in="SourceGraphic"></feMergeNode>
                                    </feMerge>
                                </filter>
                            </defs>
                            <g filter="url(#level-soft-shadow)">
                                <line stroke="#ff9045" stroke-linecap="round" stroke-width="6" x1="100" x2="100" y1="30"
                                    y2="55"></line>
                                <circle cx="100" cy="25" fill="#ff9045" r="8"></circle>
                                <rect fill="white" height="90" rx="20" width="100" x="50" y="55"></rect>
                                <circle cx="75" cy="90" fill="#112117" r="8"></circle>
                                <circle cx="77" cy="88" fill="white" r="2"></circle>
                                <circle cx="125" cy="90" fill="#112117" r="8"></circle>
                                <circle cx="127" cy="88" fill="white" r="2"></circle>
                                <circle cx="65" cy="105" fill="#ff9045" opacity="0.3" r="7"></circle>
                                <circle cx="135" cy="105" fill="#ff9045" opacity="0.3" r="7"></circle>
                                <path d="M85 115 Q100 125 115 115" fill="none" stroke="#112117" stroke-linecap="round"
                                    stroke-width="4"></path>
                                <path d="M60 160 C60 150 70 150 70 150 H130 C130 150 140 150 140 160 V220 H60 V160 Z"
                                    fill="white"></path>
                                <circle cx="90" cy="175" fill="#ff9045" r="5"></circle>
                                <circle cx="110" cy="175" fill="#ff9045" r="5"></circle>
                                <circle cx="90" cy="195" fill="#e2e8f0" r="5"></circle>
                                <circle cx="110" cy="195" fill="#e2e8f0" r="5"></circle>
                            </g>
                        </svg>
                    </div>
                    <div class="level-spark spark-large"></div>
                    <div class="level-spark spark-small"></div>
                </div>

                <h1 class="level-title">¬°Nivel Completado!</h1>

                <div class="level-stats-grid">
                    <div class="level-stat-card">
                        <span class="level-stat-label">Puntuaci√≥n</span>
                        <span id="result-score" class="level-stat-value score">1200</span>
                    </div>
                    <div class="level-stat-card">
                        <span class="level-stat-label">Precisi√≥n</span>
                        <span id="result-accuracy" class="level-stat-value accuracy">80%</span>
                    </div>
                    <div class="level-stat-card">
                        <span class="level-stat-label">XP Ganados</span>
                        <span id="result-xp" class="level-stat-value xp-gain">+985</span>
                    </div>
                </div>

                <div class="level-streak" id="streak-bonus" hidden>
                    <span class="material-symbols-outlined">local_fire_department</span>
                    <span>Bonus de Racha: +25 XP</span>
                </div>

                <div class="level-premium-card">
                    <div class="level-premium-meta">
                        <span class="level-premium-pill">Anuncio</span>
                        <span class="level-premium-lock material-symbols-outlined">lock_open</span>
                    </div>
                    <h3 class="level-premium-title">Desbloquea Todo</h3>
                    <p class="level-premium-desc">Aprende sin l√≠mites con Premium</p>
                    <button class="level-premium-btn">Ver Oferta</button>
                </div>

                <div class="level-actions">
                    <div class="level-actions-grid">
                        <button id="try-again-btn" class="level-action-btn ghost">Intentar de Nuevo</button>
                        <button id="next-level-btn" class="level-action-btn primary">
                            <span>Siguiente Nivel</span>
                            <span class="material-symbols-outlined">arrow_forward</span>
                        </button>
                    </div>
                    <button id="results-home-btn" class="level-home-link">Volver al Inicio</button>
                </div>
            </div>
        </section>

        <!-- Progress Screen -->
        <section id="progress-screen" class="screen" role="main" aria-label="Tu Progreso">
            <header class="screen-header">
                <button id="progress-back-btn" class="icon-btn back-btn" aria-label="Volver al panel">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7" />
                    </svg>
                </button>
                <h1>Tu Progreso</h1>
                <div class="spacer"></div>
            </header>

            <div class="progress-content">
                <div class="progress-hero">
                    <div class="total-xp-display">
                        <span id="progress-xp" class="big-number">0</span>
                        <span class="big-label">XP Total</span>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-icon">üìö</span>
                        <span id="levels-completed" class="stat-number">0</span>
                        <span class="stat-name">Niveles Completados</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-icon">üéØ</span>
                        <span id="avg-accuracy" class="stat-number">0%</span>
                        <span class="stat-name">Precisi√≥n Promedio</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-icon">üî•</span>
                        <span id="best-streak" class="stat-number">0</span>
                        <span class="stat-name">Mejor Racha</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-icon">üìù</span>
                        <span id="letters-learned" class="stat-number">0/26</span>
                        <span class="stat-name">Letras Aprendidas</span>
                    </div>
                </div>

                <div class="recent-activity">
                    <h2>Actividad Reciente</h2>
                    <div id="activity-list" class="activity-list">
                        <p class="empty-state">¬°Completa niveles para ver tu actividad aqu√≠!</p>
                    </div>
                </div>

                <div class="achievements-section">
                    <h2>Logros</h2>
                    <div id="achievements-list" class="achievements-list">
                        <!-- Achievements will be populated by JS -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Games Screen (Juegos) -->
        <section id="games-screen" class="screen games-screen-new" role="main" aria-label="Juegos">
            <!-- Background decorations -->
            <div class="games-bg-pattern"></div>
            <div class="games-glow"></div>

            <!-- Header with back button -->
            <header class="games-header">
                <button id="games-back-btn" class="games-back-btn back-btn" aria-label="Volver">
                    <span class="material-symbols-outlined">arrow_back</span>
                </button>
                <h1 class="games-header-title">Juegos</h1>
                <div class="games-header-spacer"></div>
            </header>

            <!-- Main Content -->
            <main class="games-main-content">
                <!-- Mascot Row -->
                <div class="games-mascot-row">
                    <div class="games-mascot-container">
                        <svg class="games-pet-svg" fill="none" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <filter height="140%" id="games-soft-shadow" width="140%" x="-20%" y="-20%">
                                    <feGaussianBlur in="SourceAlpha" stdDeviation="2"></feGaussianBlur>
                                    <feOffset dx="0" dy="3" result="offsetblur"></feOffset>
                                    <feComponentTransfer>
                                        <feFuncA slope="0.15" type="linear"></feFuncA>
                                    </feComponentTransfer>
                                    <feMerge>
                                        <feMergeNode></feMergeNode>
                                        <feMergeNode in="SourceGraphic"></feMergeNode>
                                    </feMerge>
                                </filter>
                            </defs>
                            <g filter="url(#games-soft-shadow)">
                                <!-- Antenna -->
                                <line stroke="#112117" stroke-linecap="round" stroke-width="4" x1="100" x2="100" y1="50"
                                    y2="25"></line>
                                <circle class="mascot-antenna" cx="100" cy="25" fill="#ff9045" r="7"></circle>
                                <!-- Arms -->
                                <path d="M 45 110 Q 30 110 35 80" stroke="white" stroke-linecap="round"
                                    stroke-width="12"></path>
                                <path class="mascot-arm-r" d="M 155 110 Q 170 110 165 130" stroke="white"
                                    stroke-linecap="round" stroke-width="12"></path>
                                <!-- Body -->
                                <rect class="mascot-body" fill="white" height="110" rx="45" width="100" x="50" y="50">
                                </rect>
                                <!-- Face -->
                                <g transform="translate(0, 10)">
                                    <ellipse class="mascot-eye" cx="80" cy="80" fill="#112117" rx="10" ry="12">
                                    </ellipse>
                                    <ellipse class="mascot-eye" cx="120" cy="80" fill="#112117" rx="10" ry="12">
                                    </ellipse>
                                    <circle cx="84" cy="76" fill="white" r="3"></circle>
                                    <circle cx="124" cy="76" fill="white" r="3"></circle>
                                    <circle cx="65" cy="95" fill="#ff9045" opacity="0.4" r="5"></circle>
                                    <circle cx="135" cy="95" fill="#ff9045" opacity="0.4" r="5"></circle>
                                    <path d="M 90 95 Q 100 102 110 95" fill="none" stroke="#112117"
                                        stroke-linecap="round" stroke-width="3"></path>
                                </g>
                                <!-- Belly panel with Braille dots -->
                                <rect x="75" y="120" width="50" height="30" rx="8" fill="#ffedd5"></rect>
                                <circle cx="90" cy="135" r="3" fill="#ff9045"></circle>
                                <circle cx="110" cy="135" r="3" fill="#ff9045"></circle>
                            </g>
                        </svg>
                    </div>
                    <div class="games-speech-bubble">
                        <p>¬°Hora de jugar! Elige un desaf√≠o y gana puntos.</p>
                        <div class="games-bubble-tail"></div>
                    </div>
                </div>

                <h2 class="games-title">Aprende Jugando</h2>

                <!-- Games List -->
                <div class="games-list">
                    <!-- Sponsored Game Card -->
                    <div class="game-card sponsored">
                        <div class="game-card-content">
                            <div class="game-card-header">
                                <div class="game-icon">
                                    <span class="material-symbols-outlined">star</span>
                                </div>
                                <span class="game-difficulty">Promocionado</span>
                            </div>
                            <div class="game-info">
                                <h3 class="game-name">Juego Misterioso</h3>
                                <p class="game-desc">Descubre nuevos desaf√≠os con nuestros socios.</p>
                            </div>
                            <button class="game-play-btn">
                                <span class="material-symbols-outlined">open_in_new</span>
                                ABRIR
                            </button>
                        </div>
                    </div>
                    <!-- Game Card 1: Adivina la Letra -->
                    <div class="game-card" id="game-guess-letter">
                        <div class="game-card-glow game-card-glow-orange"></div>
                        <div class="game-card-content">
                            <div class="game-card-header">
                                <div class="game-icon game-icon-orange">
                                    <span class="material-symbols-outlined">quiz</span>
                                </div>
                                <span class="game-difficulty game-difficulty-easy">F√°cil</span>
                            </div>
                            <div class="game-info">
                                <h3 class="game-name">Adivina la Letra</h3>
                                <p class="game-desc">Identifica qu√© letra representa el patr√≥n Braille que ves en
                                    pantalla.</p>
                            </div>
                            <button class="game-play-btn game-play-btn-primary" id="play-guess-letter">
                                <span class="material-symbols-outlined">play_circle</span>
                                JUGAR
                            </button>
                        </div>
                    </div>

                    <!-- Game Card 2: Forma la Palabra -->
                    <div class="game-card" id="game-form-word">
                        <div class="game-card-glow game-card-glow-blue"></div>
                        <div class="game-card-content">
                            <div class="game-card-header">
                                <div class="game-icon game-icon-blue">
                                    <span class="material-symbols-outlined">sort_by_alpha</span>
                                </div>
                                <span class="game-difficulty game-difficulty-medium">Medio</span>
                            </div>
                            <div class="game-info">
                                <h3 class="game-name">Forma la Palabra</h3>
                                <p class="game-desc">Ordena los caracteres Braille para construir la palabra correcta.
                                </p>
                            </div>
                            <button class="game-play-btn game-play-btn-blue" id="play-form-word">
                                <span class="material-symbols-outlined">play_circle</span>
                                JUGAR
                            </button>
                        </div>
                    </div>

                    <!-- Game Card 3: Memoria Braille -->
                    <div class="game-card" id="game-memory">
                        <div class="game-card-glow game-card-glow-purple"></div>
                        <div class="game-card-content">
                            <div class="game-card-header">
                                <div class="game-icon game-icon-purple">
                                    <span class="material-symbols-outlined">style</span>
                                </div>
                                <span class="game-difficulty game-difficulty-hard">Dif√≠cil</span>
                            </div>
                            <div class="game-info">
                                <h3 class="game-name">Memoria Braille</h3>
                                <p class="game-desc">Encuentra las parejas entre letras latinas y s√≠mbolos Braille.</p>
                            </div>
                            <button class="game-play-btn game-play-btn-purple" id="play-memory">
                                <span class="material-symbols-outlined">play_circle</span>
                                JUGAR
                            </button>
                        </div>
                    </div>
                </div>
            </main>
        </section>

        <!-- Game Play Screen: Adivina la Letra -->
        <section id="guess-letter-screen" class="screen game-play-screen" role="main" aria-label="Adivina la Letra">
            <!-- Background -->
            <div class="game-play-bg-pattern"></div>
            <div class="game-play-glow"></div>

            <!-- Header -->
            <header class="game-play-header">
                <button id="guess-letter-back-btn" class="game-play-back-btn back-btn" aria-label="Salir del juego">
                    <span class="material-symbols-outlined">close</span>
                </button>
                <div class="game-play-stats">
                    <div class="game-stat">
                        <span class="material-symbols-outlined">star</span>
                        <span id="guess-letter-score">0</span>
                    </div>
                    <div class="game-stat game-stat-lives">
                        <span id="guess-letter-lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
                    </div>
                </div>
                <div class="game-play-progress">
                    <span id="guess-letter-round">1</span>/<span id="guess-letter-total">10</span>
                </div>
            </header>

            <!-- Game Content -->
            <main class="game-play-content">
                <h2 class="game-play-question">¬øQu√© letra es esta?</h2>

                <!-- Braille Cell Display -->
                <div class="game-braille-display">
                    <div class="game-braille-cell" id="guess-braille-cell">
                        <button class="game-braille-dot" data-dot="1"></button>
                        <button class="game-braille-dot" data-dot="4"></button>
                        <button class="game-braille-dot" data-dot="2"></button>
                        <button class="game-braille-dot" data-dot="5"></button>
                        <button class="game-braille-dot" data-dot="3"></button>
                        <button class="game-braille-dot" data-dot="6"></button>
                    </div>
                </div>

                <!-- Answer Options -->
                <div class="game-answer-options" id="guess-letter-options">
                    <button class="game-answer-btn" data-letter="A">A</button>
                    <button class="game-answer-btn" data-letter="B">B</button>
                    <button class="game-answer-btn" data-letter="C">C</button>
                    <button class="game-answer-btn" data-letter="D">D</button>
                </div>

                <!-- Feedback -->
                <div class="game-feedback hidden" id="guess-letter-feedback">
                    <div class="game-feedback-icon"></div>
                    <p class="game-feedback-text"></p>
                </div>
            </main>

            <!-- Footer with Next Button -->
            <footer class="game-play-footer hidden" id="guess-letter-footer">
                <button class="game-play-next-btn" id="guess-letter-next">
                    Siguiente
                    <span class="material-symbols-outlined">arrow_forward</span>
                </button>
            </footer>
        </section>

        <!-- Game Over Screen -->
        <section id="game-over-screen" class="screen game-over-screen" role="main" aria-label="Fin del Juego">
            <div class="game-over-bg-pattern"></div>

            <main class="game-over-content">
                <div class="game-over-icon" id="game-over-icon">üéâ</div>
                <h1 class="game-over-title" id="game-over-title">¬°Excelente!</h1>
                <p class="game-over-subtitle" id="game-over-subtitle">Has completado el juego</p>

                <div class="game-over-stats">
                    <div class="game-over-stat">
                        <span class="game-over-stat-value" id="game-over-score">0</span>
                        <span class="game-over-stat-label">Puntos</span>
                    </div>
                    <div class="game-over-stat">
                        <span class="game-over-stat-value" id="game-over-correct">0</span>
                        <span class="game-over-stat-label">Correctas</span>
                    </div>
                    <div class="game-over-stat">
                        <span class="game-over-stat-value" id="game-over-accuracy">0%</span>
                        <span class="game-over-stat-label">Precisi√≥n</span>
                    </div>
                </div>

                <div class="game-over-xp">
                    <span class="material-symbols-outlined">stars</span>
                    <span id="game-over-xp-value">+50 XP</span>
                </div>

                <div class="game-over-actions">
                    <button class="game-over-btn-primary" id="game-over-play-again">
                        <span class="material-symbols-outlined">replay</span>
                        Jugar de Nuevo
                    </button>
                    <button class="game-over-btn-secondary" id="game-over-back">
                        Volver a Juegos
                    </button>
                </div>
            </main>
        </section>

        <!-- Game Play Screen: Forma la Palabra -->
        <section id="form-word-screen" class="screen game-play-screen" role="main" aria-label="Forma la Palabra">
            <!-- Background -->
            <div class="game-play-bg-pattern game-play-bg-blue"></div>
            <div class="game-play-glow game-play-glow-blue"></div>

            <!-- Header -->
            <header class="game-play-header">
                <button id="form-word-back-btn" class="game-play-back-btn back-btn" aria-label="Salir del juego">
                    <span class="material-symbols-outlined">close</span>
                </button>
                <div class="game-play-stats">
                    <div class="game-stat">
                        <span class="material-symbols-outlined">star</span>
                        <span id="form-word-score">0</span>
                    </div>
                    <div class="game-stat game-stat-lives">
                        <span id="form-word-lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
                    </div>
                </div>
                <div class="game-play-progress">
                    <span id="form-word-round">1</span>/<span id="form-word-total">5</span>
                </div>
            </header>

            <!-- Game Content -->
            <main class="game-play-content">
                <h2 class="game-play-question">Forma la palabra:</h2>
                <div class="form-word-target" id="form-word-target">CASA</div>

                <!-- Letter slots to fill -->
                <div class="form-word-slots" id="form-word-slots">
                    <!-- Dynamically filled -->
                </div>

                <!-- Available Braille letters to drag -->
                <div class="form-word-options" id="form-word-options">
                    <!-- Dynamically filled -->
                </div>

                <!-- Feedback -->
                <div class="game-feedback hidden" id="form-word-feedback">
                    <div class="game-feedback-icon"></div>
                    <p class="game-feedback-text"></p>
                </div>
            </main>

            <!-- Footer with Check/Next Button -->
            <footer class="game-play-footer" id="form-word-footer">
                <button class="game-play-next-btn game-check-btn" id="form-word-check" disabled>
                    <span class="material-symbols-outlined">check</span>
                    Verificar
                </button>
                <button class="game-play-next-btn hidden" id="form-word-next">
                    Siguiente
                    <span class="material-symbols-outlined">arrow_forward</span>
                </button>
            </footer>
        </section>

        <!-- Game Play Screen: Memoria Braille -->
        <section id="memory-screen" class="screen game-play-screen" role="main" aria-label="Memoria Braille">
            <!-- Background -->
            <div class="game-play-bg-pattern game-play-bg-purple"></div>
            <div class="game-play-glow game-play-glow-purple"></div>

            <!-- Header -->
            <header class="game-play-header">
                <button id="memory-back-btn" class="game-play-back-btn back-btn" aria-label="Salir del juego">
                    <span class="material-symbols-outlined">close</span>
                </button>
                <div class="game-play-stats">
                    <div class="game-stat">
                        <span class="material-symbols-outlined">style</span>
                        <span id="memory-pairs">0</span>/<span id="memory-total-pairs">6</span>
                    </div>
                    <div class="game-stat">
                        <span class="material-symbols-outlined">touch_app</span>
                        <span id="memory-moves">0</span>
                    </div>
                </div>
                <div class="game-play-timer">
                    <span class="material-symbols-outlined">timer</span>
                    <span id="memory-timer">0:00</span>
                </div>
            </header>

            <!-- Game Content -->
            <main class="game-play-content memory-content">
                <h2 class="game-play-question memory-instruction">Encuentra las parejas</h2>

                <!-- Memory Card Grid -->
                <div class="memory-grid" id="memory-grid">
                    <!-- 12 cards (6 pairs) will be dynamically generated -->
                </div>
            </main>
        </section>

        <!-- Settings Screen -->
        <section id="settings-screen" class="screen settings-new" role="main" aria-label="Configuraci√≥n">
            <header class="settings-header-new">
                <div class="settings-header-left">
                    <button id="settings-back-btn" class="settings-back-btn back-btn" aria-label="Volver al panel">
                        <span class="material-symbols-outlined">arrow_back</span>
                    </button>
                    <h1>Ajustes</h1>
                </div>
                <div class="braille-dots-mini">
                    <span></span><span class="orange"></span>
                    <span></span><span></span>
                </div>
            </header>

            <div class="settings-content-new">
                <!-- Profile Card -->
                <div class="profile-card-new">
                    <div class="profile-avatar-new" id="settings-avatar">
                        <span id="settings-initials">AP</span>
                    </div>
                    <div class="profile-info-new">
                        <h2 id="settings-name">Aprendiz</h2>
                        <p class="profile-email" id="settings-email">Sin correo configurado</p>
                        <button class="profile-edit-btn">
                            Editar informaci√≥n
                            <span class="material-symbols-outlined">edit</span>
                        </button>
                    </div>
                    <div class="profile-card-accent"></div>
                </div>

                <!-- General Section -->
                <div class="settings-section-new">
                    <h3 class="settings-section-title-new">General</h3>
                    <div class="settings-card-new">
                        <button class="settings-row-new">
                            <div class="settings-row-left">
                                <div class="settings-icon blue">
                                    <span class="material-symbols-outlined">translate</span>
                                </div>
                                <span class="settings-label">Idioma</span>
                            </div>
                            <div class="settings-row-right">
                                <span class="settings-value">Espa√±ol</span>
                                <span class="material-symbols-outlined chevron">chevron_right</span>
                            </div>
                        </button>
                        <div class="settings-divider"></div>
                        <div class="settings-row-new">
                            <div class="settings-row-left">
                                <div class="settings-icon purple">
                                    <span class="material-symbols-outlined">dark_mode</span>
                                </div>
                                <span class="settings-label">Modo Oscuro</span>
                            </div>
                            <button id="settings-dark-mode" class="toggle-switch-new" role="switch"
                                aria-checked="false">
                                <span class="toggle-track-new"><span class="toggle-thumb-new"></span></span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Notifications Section -->
                <div class="settings-section-new">
                    <h3 class="settings-section-title-new">Notificaciones</h3>
                    <div class="settings-card-new">
                        <div class="settings-row-new">
                            <div class="settings-row-left">
                                <div class="settings-icon orange">
                                    <span class="material-symbols-outlined">notifications_active</span>
                                </div>
                                <div class="settings-label-group">
                                    <span class="settings-label">Recordatorios</span>
                                    <span class="settings-sublabel">Pr√°ctica diaria</span>
                                </div>
                            </div>
                            <button id="settings-reminders" class="toggle-switch-new on" role="switch"
                                aria-checked="true">
                                <span class="toggle-track-new"><span class="toggle-thumb-new"></span></span>
                            </button>
                        </div>
                        <div class="settings-divider"></div>
                        <div class="settings-row-new">
                            <div class="settings-row-left">
                                <div class="settings-icon green">
                                    <span class="material-symbols-outlined">mail</span>
                                </div>
                                <div class="settings-label-group">
                                    <span class="settings-label">Novedades</span>
                                    <span class="settings-sublabel">Correo electr√≥nico</span>
                                </div>
                            </div>
                            <button id="settings-email-notif" class="toggle-switch-new" role="switch"
                                aria-checked="false">
                                <span class="toggle-track-new"><span class="toggle-thumb-new"></span></span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Support Section -->
                <div class="settings-section-new">
                    <h3 class="settings-section-title-new">Soporte</h3>
                    <div class="settings-card-new">
                        <button class="settings-row-new">
                            <div class="settings-row-left">
                                <div class="settings-icon teal">
                                    <span class="material-symbols-outlined">help</span>
                                </div>
                                <span class="settings-label">Centro de Ayuda</span>
                            </div>
                            <span class="material-symbols-outlined chevron">chevron_right</span>
                        </button>
                        <div class="settings-divider"></div>
                        <button class="settings-row-new">
                            <div class="settings-row-left">
                                <div class="settings-icon teal">
                                    <span class="material-symbols-outlined">policy</span>
                                </div>
                                <span class="settings-label">T√©rminos y Privacidad</span>
                            </div>
                            <span class="material-symbols-outlined chevron">chevron_right</span>
                        </button>
                    </div>
                </div>

                <!-- Debug Section (Zona de Pruebas) -->
                <div class="settings-section-new" style="border: 2px dashed #f59e0b; background: #fffbeb;">
                    <h3 class="settings-section-title-new" style="color: #d97706;">Zona de Pruebas üöß</h3>
                    <div class="settings-card-new">
                        <button id="debug-unlock-all" class="settings-row-new"
                            onclick="window.debugUnlockAll && window.debugUnlockAll()">
                            <div class="settings-row-left">
                                <div class="settings-icon orange">
                                    <span class="material-symbols-outlined">lock_open</span>
                                </div>
                                <span class="settings-label">Desbloquear Todo</span>
                            </div>
                            <span class="material-symbols-outlined chevron">chevron_right</span>
                        </button>
                        <div class="settings-divider"></div>
                        <button id="debug-reset-progress" class="settings-row-new"
                            onclick="window.debugResetProgress && window.debugResetProgress()">
                            <div class="settings-row-left">
                                <div class="settings-icon red">
                                    <span class="material-symbols-outlined">restart_alt</span>
                                </div>
                                <span class="settings-label">Reiniciar Progreso</span>
                            </div>
                            <span class="material-symbols-outlined chevron">chevron_right</span>
                        </button>
                    </div>
                </div>

                <!-- Accessibility Section -->
                <div class="settings-section-new">
                    <h3 class="settings-section-title-new">Accesibilidad</h3>
                    <div class="settings-card-new">
                        <div class="settings-row-new">
                            <div class="settings-row-left">
                                <div class="settings-icon indigo">
                                    <span class="material-symbols-outlined">record_voice_over</span>
                                </div>
                                <div class="settings-label-group">
                                    <span class="settings-label">Modo Lector de Pantalla</span>
                                    <span class="settings-sublabel">Gu√≠a de audio adicional</span>
                                </div>
                            </div>
                            <button id="settings-screen-reader" class="toggle-switch-new" role="switch"
                                aria-checked="false">
                                <span class="toggle-track-new"><span class="toggle-thumb-new"></span></span>
                            </button>
                        </div>
                        <div class="settings-divider"></div>
                        <div class="settings-row-new">
                            <div class="settings-row-left">
                                <div class="settings-icon rose">
                                    <span class="material-symbols-outlined">vibration</span>
                                </div>
                                <div class="settings-label-group">
                                    <span class="settings-label">Respuesta H√°ptica</span>
                                    <span class="settings-sublabel">Vibraci√≥n de retroalimentaci√≥n</span>
                                </div>
                            </div>
                            <button id="settings-haptic" class="toggle-switch-new on" role="switch" aria-checked="true">
                                <span class="toggle-track-new"><span class="toggle-thumb-new"></span></span>
                            </button>
                        </div>
                        <div class="settings-divider"></div>
                        <div class="settings-row-new">
                            <div class="settings-row-left">
                                <div class="settings-icon slate">
                                    <span class="material-symbols-outlined">contrast</span>
                                </div>
                                <div class="settings-label-group">
                                    <span class="settings-label">Alto Contraste</span>
                                    <span class="settings-sublabel">Aumentar claridad visual</span>
                                </div>
                            </div>
                            <button id="settings-contrast" class="toggle-switch-new" role="switch" aria-checked="false">
                                <span class="toggle-track-new"><span class="toggle-thumb-new"></span></span>
                            </button>
                        </div>
                        <div class="settings-divider"></div>
                        <div class="settings-row-new">
                            <div class="settings-row-left">
                                <div class="settings-icon amber">
                                    <span class="material-symbols-outlined">timer</span>
                                </div>
                                <div class="settings-label-group">
                                    <span class="settings-label">Desaf√≠os Cronometrados</span>
                                    <span class="settings-sublabel">Habilitar presi√≥n de tiempo</span>
                                </div>
                            </div>
                            <button id="settings-timed" class="toggle-switch-new" role="switch" aria-checked="false">
                                <span class="toggle-track-new"><span class="toggle-thumb-new"></span></span>
                            </button>
                        </div>
                        <div class="settings-divider"></div>
                        <div class="settings-row-new">
                            <div class="settings-row-left">
                                <div class="settings-icon cyan">
                                    <span class="material-symbols-outlined">speed</span>
                                </div>
                                <span class="settings-label">Velocidad de Audio</span>
                            </div>
                            <div class="speed-control-new">
                                <button class="speed-btn-new" data-speed="0.75">0.75x</button>
                                <button class="speed-btn-new active" data-speed="1">1x</button>
                                <button class="speed-btn-new" data-speed="1.5">1.5x</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bottom Section with Mascot and Logout -->
                <div class="settings-bottom-new">
                    <div class="settings-mascot-container">
                        <div class="settings-mascot-bubble">
                            <p>¬øNecesitas ayuda?</p>
                        </div>
                        <div class="settings-mascot">
                            <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                <g>
                                    <line x1="100" y1="50" x2="100" y2="25" stroke="#112117" stroke-width="4"
                                        stroke-linecap="round" />
                                    <circle class="mascot-antenna" cx="100" cy="25" r="7" fill="#ff9045" />
                                    <path d="M 45 110 Q 30 110 35 80" stroke="white" stroke-linecap="round"
                                        stroke-width="12" />
                                    <path class="mascot-arm-r" d="M 155 110 Q 170 110 165 130" stroke="white"
                                        stroke-linecap="round" stroke-width="12" />
                                    <rect class="mascot-body" x="50" y="50" width="100" height="110" rx="45"
                                        fill="white" />
                                    <g transform="translate(0, 10)">
                                        <ellipse class="mascot-eye" cx="80" cy="80" rx="10" ry="12" fill="#112117" />
                                        <ellipse class="mascot-eye" cx="120" cy="80" rx="10" ry="12" fill="#112117" />
                                        <circle cx="84" cy="76" r="3" fill="white" />
                                        <circle cx="124" cy="76" r="3" fill="white" />
                                        <circle cx="65" cy="95" r="5" fill="#ff9045" opacity="0.4" />
                                        <circle cx="135" cy="95" r="5" fill="#ff9045" opacity="0.4" />
                                        <path d="M 90 95 Q 100 102 110 95" fill="none" stroke="#112117"
                                            stroke-linecap="round" stroke-width="3" />
                                    </g>
                                    <rect x="75" y="120" width="50" height="30" rx="8" fill="#ffedd5" />
                                    <circle cx="90" cy="135" r="3" fill="#ff9045" />
                                    <circle cx="110" cy="135" r="3" fill="#ff9045" />
                                </g>
                            </svg>
                        </div>
                    </div>
                    <button id="settings-logout" class="logout-btn-new">
                        <span class="material-symbols-outlined">logout</span>
                        Cerrar Sesi√≥n
                    </button>
                </div>

                <p class="settings-version">Braillito v1.2.4</p>
            </div>
        </section>

        <!-- Achievement Popup -->
        <div id="achievement-popup" class="achievement-popup hidden" role="alertdialog" aria-modal="true"
            aria-labelledby="achievement-title">
            <div class="achievement-backdrop"></div>
            <div class="achievement-modal">
                <div class="achievement-badge" aria-hidden="true">üèÜ</div>
                <h2 id="achievement-title">¬°Logro Desbloqueado!</h2>
                <p id="achievement-name" class="achievement-name">Primeros Pasos</p>
                <p id="achievement-desc" class="achievement-desc">Construye tu primera letra Braille</p>
                <div class="achievement-xp">+50 XP</div>
                <button id="achievement-close" class="btn btn-primary">¬°Genial!</button>
            </div>
        </div>

        <!-- Global Exit Confirmation Modal -->
        <div id="exit-confirm-overlay" class="feedback-overlay hidden" role="alertdialog" aria-modal="true">
            <div class="feedback-content">
                <div class="feedback-icon" aria-hidden="true">üö™</div>
                <h2>¬øSalir del juego?</h2>
                <p>Tu progreso en este nivel se perder√°.</p>
                <div class="exit-confirm-actions">
                    <button id="exit-confirm-no" class="btn btn-secondary">Continuar jugando</button>
                    <button id="exit-confirm-yes" class="btn btn-primary">Salir</button>
                </div>
            </div>
        </div>

        <!-- Navigation Bar (New Braillito Design) -->
        <nav id="main-nav" class="main-nav-new hidden" aria-label="Navegaci√≥n Principal">
            <div class="nav-container">
                <button class="nav-tab active" data-screen="dashboard-screen" aria-label="Inicio">
                    <div class="nav-tab-icon-wrap active">
                        <span class="nav-tab-icon">üè†</span>
                    </div>
                    <span class="nav-tab-label">Inicio</span>
                </button>
                <button class="nav-tab" data-screen="levels-screen" aria-label="Aprender">
                    <div class="nav-tab-icon-wrap">
                        <span class="nav-tab-icon">üìö</span>
                    </div>
                    <span class="nav-tab-label">Aprender</span>
                </button>
                <button class="nav-tab" data-screen="games-screen" aria-label="Juegos">
                    <div class="nav-tab-icon-wrap">
                        <span class="nav-tab-icon">üéÆ</span>
                    </div>
                    <span class="nav-tab-label">Juegos</span>
                </button>
                <button class="nav-tab" data-screen="settings-screen" aria-label="Perfil">
                    <div class="nav-tab-icon-wrap">
                        <span class="nav-tab-icon">üë§</span>
                    </div>
                    <span class="nav-tab-label">Perfil</span>
                </button>
            </div>
        </nav>
    </div>

    <script type="module" src="braille-data.js"></script>
    <script type="module" src="app.js"></script>
</body>

</html>